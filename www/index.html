<!doctype html>
<meta charset="UTF-8">
<meta name=viewport content="width=device-width, initial-scale=1">

<title>Voting Thing</title>
<link rel="stylesheet" href="css/all.min.css">
<script src="cordova.js"></script>
<script src="js/all.min.js"></script>

<div data-role="page" id="index">

  <!-- APP_EXCLUDE_START -->
  <div data-role="popup" data-history="false" id="share-popup" class="ui-corner-all">
    <form>
      <div style="padding:10px 20px;">
        <label for="share-link">Share this link</label>
        <input id="share-link" readonly type="text">
      </div>
    </form>
  </div>
  <!-- APP_EXCLUDE_END -->

  <div data-role="panel" id="vt-panel" data-display="overlay" data-position="right">
    <form data-bind="submit: enterRoom">
      <label for="room-input">Room</label>
      <input id="room-input" type="text" maxlength="20" data-clear-btn="true" required data-bind="value: roomInput">
      <button data-theme="b">Enter Room</button>
    </form>
    <div data-role="collapsible" data-collapsed="false">
      <h2>Who's in the Room</h2>
      <ul data-role="listview" data-bind="foreach: people, jqmRefreshList: people">
        <li data-icon="edit"><!-- data-bind="attr: {'data-icon1': is_me ? 'edit' : null}" -->
          <!-- ko if: is_me -->
          <a data-bind="text: name, click: $parent.editName"></a>
          <!-- /ko -->
          <!-- ko ifnot: is_me -->
          <!--ko text: name--><!--/ko-->
          <!-- /ko -->
        </li>
      </ul>
    </div>
  </div>

  <div data-role="header">
    <a href="#" class="ui-btn-left" data-icon="refresh" data-iconpos="notext" data-role="button" data-bind="click: refresh"></a>
    <h1 data-bind="text: room() || 'Voting Thing'"></h1>
    <!-- ko if: isSetup -->
    <a href="#vt-panel" class="hamburger ui-btn-right" data-icon="bars" data-iconpos="notext" data-role="button"></a>
    <!-- /ko -->
  </div>

  <div role="main" class="ui-content">
    <!-- ko if: isSetup -->
    <div data-bind="template: {name: 'poll-area-template', afterRender: jqmRefreshPollArea}"></div>
    <!-- /ko -->
    <!-- ko ifnot: isSetup -->
    <div data-bind="template: {name: 'setup-template', afterRender: jqmRefreshSetup}"></div>
    <!-- /ko -->
  </div>

</div>

<script type="text/html" id="setup-template">
<form data-bind="submit: setup">
  <label for="setup-name">What is your name?</label>
  <input id="setup-name" type="text" maxlength="20" data-clear-btn="true" required data-bind="value: me.name">
  <label for="setup-room">What room do you want to go to?</label>
  <input id="setup-room" type="text" maxlength="20" data-clear-btn="true" placeholder="Room name" required data-bind="value: roomInput">
  <button data-theme="b">Enter</button>
</form>
</script>


<script type="text/html" id="poll-area-template">
<div class="new-poll-area" data-role="collapsible">
  <h2>New Poll</h2>

  <form data-bind="submit: createPoll">
    <label for="new-poll-name">Name</label>
    <input id="new-poll-name" type="text" maxlength="20" data-clear-btn="true" placeholder="Poll Name" required data-bind="value: newPollName">

    <div data-role="tabs" id="tabs">
      <div data-role="navbar" class="poll-type-select">
        <ul>
          <li>
            <a href="#poll-type-item-choice" data-poll-type="item-choice" data-ajax="false" class="ui-btn-active">Item
              Choice</a></li>
          <li><a href="#poll-type-range" data-poll-type="range" data-ajax="false">Range</a></li>
        </ul>
      </div>
      <div id="poll-type-item-choice">
        <label for="new-item-choice" class="ui-hidden-accessible">New Item</label>
        <input id="new-item-choice" type="text" maxlength="20" data-clear-btn="true" placeholder="New Item" data-bind="value: newItemInput">
        <button type="button" data-bind="click: addItem">Add Item</button>
        <ol data-role="listview" data-split-icon="delete" data-inset="true" data-bind="foreach: items, jqmRefreshList: items">
          <li>
            <a href="#" data-bind="text: $data"></a>
            <a href="#" data-bind="click: $root.removeItem">Delete Item</a>
          </li>
        </ol>
      </div>
      <div id="poll-type-range">
        <div class="ui-grid-b">
          <div class="ui-block-a">
            <div class="ui-field-contain">
              <label for="new-poll-min">Min</label>
              <input id="new-poll-min" type="number" step="any" data-bind="value: newPollMin">
            </div>
          </div>
          <div class="ui-block-b">
            <div class="ui-field-contain">
              <label for="new-poll-max">Max</label>
              <input id="new-poll-max" type="number" step="any" data-bind="value: newPollMax">
            </div>
          </div>
          <div class="ui-block-c">
            <div class="ui-field-contain">
              <label for="new-poll-step">Step</label>
              <input id="new-poll-step" type="number" step="any" data-bind="value: newPollStep">
            </div>
          </div>
        </div>
      </div>
    </div>
    <button data-theme="b">Create Poll</button>
  </form>
</div>
<div data-bind="template: {name: 'poll-template', foreach: polls, afterAdd: jqmEnhancePollList}"></div>
</script>

<script type="text/html" id="poll-template">
<div data-role="collapsible" class="poll">
  <h2 data-bind="text: poll_name"></h2>

  <div data-bind="ifnot: haveIVoted">
    <!-- ko if: type === 'range' -->
    <input name="vote-input" type="range" data-bind="attr: {value: details.min, min: details.min, max: details.max, step: details.step}">
    <!-- /ko -->
    <!-- ko if: type === 'item-choice' -->
    <fieldset data-role="controlgroup" data-bind="foreach: details.items">
      <div class="ui-radio">
        <label class="ui-btn ui-btn-inherit ui-btn-icon-left ui-radio-off" data-bind="text: $data"></label>
        <input name="vote-input" type="radio" data-enhanced="true" data-bind="attr: {value: $data}">
      </div>
    </fieldset>
    <!-- /ko -->
    <button data-theme="b" data-bind="click: $parent.vote">Send My Vote</button>
  </div>

  <div data-bind="attr: {class: haveIVoted() ? 'voted' : 'not-voted'}">

    <!-- ko if: type === 'range' -->
    <table class="ui-table poll-results-table">
      <thead></thead>
      <tbody data-bind="foreach: votes">
      <tr>
        <td data-bind="text: name"></td>
        <td class="num" data-bind="text: $parent.haveIVoted() ? vote.toFixed($parent.details.decimals) : '?'"></td>
      </tr>
      </tbody>
      <tfoot>
      <tr>
        <th>Total</th>
        <th class="num" data-bind="text: voteSum"></th>
      </tr>
      <tr>
        <th>Average</th>
        <th class="num" data-bind="text: voteAvg"></th>
      </tr>
      </tfoot>
    </table>
    <!-- /ko -->

    <!-- ko if: type === 'item-choice' -->
    <table class="ui-table poll-results-summary-table">
      <tbody data-bind="foreach: details.items">
      <tr>
        <td data-bind="text: $data"></td>
        <td class="num" data-bind="text: $parent.itemTot($data)"></td>
      </tr>
      </tbody>
    </table>
    <hr>
    <table class="ui-table poll-results-table">
      <tbody data-bind="foreach: votes">
      <tr>
        <td data-bind="text: name"></td>
        <td class="right" data-bind="text: $parent.haveIVoted() ? vote : '?'"></td>
      </tr>
      </tbody>
    </table>
    <!-- /ko -->

  </div>

  <div data-role="controlgroup" data-type="horizontal">
    <button data-theme="b" data-bind="click: $parent.sharePoll">Share</button>
    <button data-theme="b" data-bind="click: $parent.rerunPoll">New Similar</button>
    <!-- ko if: ownPoll -->
    <button data-theme="b" data-bind="click: $parent.deletePollConfirm">Delete</button>
    <!-- /ko -->
  </div>

</div>
</script>